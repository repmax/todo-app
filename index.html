<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo App (Lit 3)</title>
  <script type="module">
    import { LitElement, html, css } from 'https://cdn.jsdelivr.net/npm/lit@2/+esm';

    class TodoItem extends LitElement {
      static styles = css`
        .todo {
          display: flex;
          align-items: center;
          padding: 10px;
          border-bottom: 1px solid #ccc;
        }
        .todo input[type="checkbox"] {
          margin-right: 10px;
        }
        .delete-btn {
          margin-left: auto; 
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1.2em;
        }
      `;

      static properties = {
        todo: { type: Object },
        onDelete: { type: Function }, 
      };

      toggleTodo() {
        this.todo.completed = !this.todo.completed;
        this.requestUpdate(); // Notify Lit about the change
      }

      render() {
        return html`
          <li class="todo">
            <input 
              type="checkbox" 
              .checked=${this.todo.completed} 
              @change=${this.toggleTodo}
            >
            <span style="${this.todo.completed ? 'text-decoration: line-through;' : ''}">
              ${this.todo.text}
            </span>
            <button class="delete-btn" @click=${this.onDelete}>&times;</button> 
          </li>
        `;
      }
    }
    customElements.define('todo-item', TodoItem);

    class TodoApp extends LitElement {
      static styles = css`
        .container {
          width: 500px;
          margin: 0 auto;
          font-family: sans-serif;
        }
        input[type="text"] {
          width: 100%;
          padding: 10px;
          box-sizing: border-box;
          border: 1px solid #ccc;
          margin-bottom: 10px;
        }
      `;

      static properties = {
        todos: { state: true },
        newTodo: { state: true },
      };

      constructor() {
        super();
        this.todos = [
          { text: 'Buy groceries', completed: false },
          { text: 'Walk the dog', completed: true },
        ];
        this.newTodo = '';
      }

      addTodo() {
        if (this.newTodo) {
          this.todos = [...this.todos, { text: this.newTodo, completed: false }];
          this.newTodo = '';
        }
      }

      deleteTodo(index) {
				console.log("deleteTodo", index);
        this.todos = this.todos.filter((_, i) => i !== index);
      }

      render() {
        return html`
          <div class="container">
            <h1>Todo List</h1>
            <input 
              type="text" 
              placeholder="Add a new todo..."
              .value=${this.newTodo}
              @input=${(e) => this.newTodo = e.target.value}
            >
            <button @click=${this.addTodo}>Add</button>

            <ul>
              ${this.todos.map((todo, index) => html`
                <todo-item 
                  .todo=${todo} 
                  .onDelete=${() => this.deleteTodo(index)} 
                ></todo-item>
              `)}
            </ul>
          </div>
        `;
      }
    }

    customElements.define('todo-app', TodoApp);
  </script>
</head>
<body>
  <todo-app></todo-app>
</body>
</html>
